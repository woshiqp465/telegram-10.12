<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>客服系统管理后台</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#f5f5f5}
.container{max-width:1200px;margin:20px auto;background:white;padding:20px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
h1{color:#333;margin-bottom:20px}
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-bottom:30px}
.stat-card{background:#0088cc;color:white;padding:20px;border-radius:8px;text-align:center}
.stat-value{font-size:32px;font-weight:bold;margin:10px 0}
table{width:100%;border-collapse:collapse}
th,td{padding:12px;text-align:left;border-bottom:1px solid #ddd}
th{background:#f8f8f8}
button{padding:8px 16px;border:none;border-radius:4px;cursor:pointer;background:#0088cc;color:white}
button:hover{background:#006699}
.login{max-width:400px;margin:100px auto;padding:40px;background:white;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
input{width:100%;padding:12px;margin:10px 0;border:1px solid #ddd;border-radius:4px}
</style>
</head>
<body>
<div id="login-page" class="login">
<h1 style="text-align:center">管理后台登录</h1>
<input id="username" type="text" placeholder="用户名" value="admin"/>
<input id="password" type="password" placeholder="密码" value="admin"/>
<button onclick="login()" style="width:100%;margin-top:10px">登录</button>
</div>
<div id="main-page" style="display:none">
<div class="container">
<h1>客服系统管理后台 <button onclick="logout()" style="float:right">退出</button></h1>
<div class="stats">
<div class="stat-card"><div>总用户</div><div class="stat-value" id="total-users">0</div></div>
<div class="stat-card"><div>活跃用户</div><div class="stat-value" id="active-users">0</div></div>
<div class="stat-card"><div>今日新增</div><div class="stat-value" id="today-users">0</div></div>
<div class="stat-card"><div>即将到期</div><div class="stat-value" id="expiring-users">0</div></div>
</div>
<h2>用户列表</h2>
<input id="search" type="text" placeholder="搜索用户ID/用户名/邮箱..." style="margin:10px 0" onkeyup="loadUsers()"/>
<table><thead><tr><th>用户ID</th><th>用户名</th><th>剩余天数</th><th>总消息</th><th>状态</th><th>操作</th></tr></thead>
<tbody id="user-list"></tbody></table>
</div>
</div>
<script>
const API='http://192.168.9.159:3001/api';
let token=localStorage.getItem('admin_token');
if(token){document.getElementById('login-page').style.display='none';document.getElementById('main-page').style.display='block';loadStats();loadUsers()}
function login(){
const u=document.getElementById('username').value;
const p=document.getElementById('password').value;
fetch(API+'/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})})
.then(r=>r.json()).then(d=>{if(d.token){token=d.token;localStorage.setItem('admin_token',token);location.reload()}else{alert('登录失败')}})
}
function logout(){localStorage.removeItem('admin_token');location.reload()}
function loadStats(){
fetch(API+'/stats',{headers:{'Authorization':'Bearer '+token}})
.then(r=>r.json()).then(d=>{
document.getElementById('total-users').textContent=d.totalUsers;
document.getElementById('active-users').textContent=d.activeUsers;
document.getElementById('today-users').textContent=d.todayUsers;
document.getElementById('expiring-users').textContent=d.expiringUsers;
})
}
function loadUsers(){
const search=document.getElementById('search').value;
fetch(API+'/users?search='+search,{headers:{'Authorization':'Bearer '+token}})
.then(r=>r.json()).then(d=>{
const tbody=document.getElementById('user-list');
tbody.innerHTML='';
d.users.forEach(u=>{
const tr=document.createElement('tr');
tr.innerHTML=`<td>${u.user_id.substring(0,20)}</td><td>${u.username||'-'}</td><td>${u.remaining_days}天</td><td>${u.total_messages}</td><td>${u.is_active?'✅':'❌'}</td><td><button onclick="recharge('${u.user_id}')">充值</button></td>`;
tbody.appendChild(tr);
})
})
}
function recharge(uid){
const days=prompt('充值天数:','30');
if(!days)return;
fetch(API+'/users/'+uid+'/recharge',{method:'POST',headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'},body:JSON.stringify({days:parseInt(days),note:'管理员充值'})})
.then(r=>r.json()).then(d=>{alert(d.message||'充值成功');loadUsers();loadStats()})
}
</script>
</body>
</html>